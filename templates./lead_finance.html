<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Finance - Sales OS</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@0.548.0/dist/umd/lucide.js"></script>
    
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.8/main.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.8/main.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.8/main.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='lead.css') }}">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @keyframes spinner-rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .loading-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: #ffffff;
            border-radius: 50%;
            animation: spinner-rotate 0.8s linear infinite;
        }
        
        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(1, 1fr); 
            gap: 20px;
        }

        @media (min-width: 640px) { 
            .stats-dashboard {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1024px) { 
            .stats-dashboard {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .stat-icon.stat-pipeline { background-color: #eef2ff; color: #4f46e5; }
        .stat-icon.stat-revenue { background-color: #f0fdf4; color: #16a34a; }
        .stat-icon.stat-won { background-color: #fefce8; color: #ca8a04; }
        .stat-icon.stat-conversion { background-color: #fdf2f8; color: #db2777; }
        .stat-icon.stat-deal-size { background-color: #f0f9ff; color: #0284c7; }
        .stat-icon.stat-velocity { background-color: #fef3f2; color: #ea580c; }
        .stat-icon.stat-cycle { background-color: #f5f3ff; color: #7c3aed; }
        .stat-icon.stat-clv { background-color: #f0fdfa; color: #0d9488; }

        .charts-section {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 20px;
            margin-top: 24px;
        }
        
        @media (min-width: 1024px) { 
            .charts-section {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .chart-card {
            background-color: #ffffff;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
            border: 1px solid #e5e7eb;
        }
        
        .chart-card h3 {
            font-size: 1.125rem; 
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 350px; 
            width: 100%;
        }
    </style>
    </head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="/static/logo.png"
                 alt="SalesOS Logo"
                 class="logo-img"
                 onerror="this.onerror=null;this.src='https://placehold.co/120x40/050507/C0FF6B?text=SalesOS&font=inter';">

        </div>
        <div class="nav">
            <ul>
                <li ><a href="/space"><div class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>Space</div></a></li>
                
                <li id="crmMenu" class="open">
                    <div class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 13h6v-2H4v2zm0 4h6v-2H4v2zm0-8h6V7H4v2zm8 2h9V7h-9v2zm0 4h9v-2h-9v2zm0 4h9v-2h-9v2z"/></svg>MIni-Crm<svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg></div>
                    <ul class="submenu">
                        <li><a href="/mini-crm/leads">Leads</a></li>
                        <li><a href="/mini-crm/deals">Deals</a></li>
                        <li><a href="/mini-crm/sales-funnel">Sales Funnel</a></li>
                        <li class="active"><a href="/mini-crm/finance">Sales Finance</a></li>
                    </ul>
                </li>
                
                <li><a href="/calendar"><div class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/></svg>Calendar</div></a></li>

                <li id="salesMenu"> <div class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-2 .89-2 2v11c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zM10 4h4v2h-4V4zm10 15H4V8h16v11z"/></svg>Sales<svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg></div>
                    <ul class="submenu">
                        <li><a href="/sales/pre-sales">Pre-Sales</a></li>
                        <li><a href="/sales/post-sales">Post-Sales</a></li>
                    </ul>
                </li>
                <li><a href="/agent-connect"><div class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12c-1.1 0-2 .9-2 2s.9 2 2 2s2-.9 2-2s-.9-2-2-2zm0-4c-1.1 0-2 .9-2 2s.9 2 2 2s2-.9 2-2s-.9-2-2-2zm0-4c-1.1 0-2 .9-2 2s.9 2 2 2s2-.9 2-2s-.9-2-2-2zm-4 4c-1.1 0-2 .9-2 2s.9 2 2 2s2-.9 2-2s-.9-2-2-2zm8 0c-1.1 0-2 .9-2 2s.9 2 2 2s2-.9 2-2s-.9-2-2-2z"/></svg>Agent Connect</div></a></li>
                </ul>
        </div>
        
        <div class="bottom-section">
            <div class="profile">
                <div class="profile-icon-container">
                    <img id="profile-img" src="" alt="User Profile" class="profile-icon-img hidden" onerror="this.classList.add('hidden'); document.getElementById('default-profile-icon').classList.remove('hidden');">
                    <svg id="default-profile-icon" class="profile-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </div>
                <span class="profile-name" id="profile-name"></span>
            </div>

            <ul class="footer-links">
                <li id="settings-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.08-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49.42l.38-2.65c.61-.25 1.17-.59 1.69.98l2.49 1c.23.08.49 0 .61.22l2-3.46c.12-.22.07.49-.12.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>
                    </svg>
                    Settings
                </li>
            </ul>
        </div>
    </div>
    <div class="toggle-btn" id="toggleBtn">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <main class="main-content" id="mainContent">
        <div class="crm-container">
            <header class="crm-header-modern">
                <div class="header-left">
                    <h1 class="page-title">Sales Finance Dashboard</h1>
                    <div class="breadcrumb">
                        <span>Dashboard</span>
                        <i data-lucide="chevron-right"></i>
                        <span>Sales Finance</span>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn-icon" id="refreshBtn" title="Refresh Data">
                        <i data-lucide="refresh-cw"></i>
                    </button>
                    <button class="btn-icon" id="filterToggleBtn" title="Toggle Filters">
                        <i data-lucide="filter"></i>
                    </button>
                    <button class="btn-secondary" id="exportBtn">
                        <i data-lucide="download"></i>
                        Export
                    </button>
                </div>
            </header>

            <section class="search-filters-section" id="filtersSection">
                <div class="filters-container" style="width: 100%;">
                    <div class="filter-group">
                        <label>Date Range</label>
                        <select id="dateRangeFilter" class="filter-select">
                            <option value="all">All Time</option>
                            <option value="month" selected>This Month</option>
                            <option value="quarter">This Quarter</option>
                            <option value="year">This Year</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>Sales Rep</label>
                        <select id="ownerFilter" class="filter-select">
                            <option value="">All Reps</option>
                            </select>
                    </div>
                    
                    <button class="btn-filter-clear" id="clearFilters">
                        <i data-lucide="x"></i>
                        Clear
                    </button>
                </div>
            </section>

            <section class="stats-dashboard" id="kpiCardContainer">
                <div class="stat-card">
                    <div class="stat-icon stat-pipeline">
                        <i data-lucide="dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="statTotalPipeline">$0</h3>
                        <p>Total Pipeline Value</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-revenue">
                        <i data-lucide="trending-up"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="statProjectedRevenue">$0</h3>
                        <p>Projected Revenue</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-won">
                        <i data-lucide="trophy"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="statWonValue">$0</h3>
                        <p>Total Won Value</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-conversion">
                        <i data-lucide="percent"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="statConversionRate">0%</h3>
                        <p>Conversion Rate</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-deal-size">
                        <i data-lucide="briefcase"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="statAvgDealSize">$0</h3>
                        <p>Avg. Deal Size</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-velocity">
                        <i data-lucide="zap"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="statSalesVelocity">$0/day</h3>
                        <p>Sales Velocity</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-cycle">
                        <i data-lucide="calendar-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="statAvgSalesCycle">0 days</h3>
                        <p>Avg. Sales Cycle</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon stat-clv">
                        <i data-lucide="repeat"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="statEstClv">$0</h3>
                        <p>Est. CLV</p>
                    </div>
                </div>
            </section>

            <section class="charts-section">
                <div class="chart-card">
                    <h3>Revenue Overview (Last 6 Months)</h3>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Pipeline by Stage</h3>
                    <div class="chart-container">
                        <canvas id="pipelineChart"></canvas>
                    </div>
                </div>
            </section>

            <section class="table-container">
                <div class="table-header">
                    <h3>Financial Summary by Sales Rep</h3>
                </div>

                <div class="data-grid-container" id="dataGridContainer">
                    <table class="data-grid" id="financeGrid">
                        <thead>
                            <tr>
                                <th>Sales Rep</th>
                                <th>Pipeline Value</th>
                                <th>Won Value</th>
                                <th>Avg. Deal Size</th>
                                <th>Conversion Rate</th>
                                <th>Sales Cycle (Days)</th>
                                <th>Win Probability (AI)</th>
                            </tr>
                        </thead>
                        <tbody id="financeTableBody">
                            <tr>
                                <td colspan="7" class="empty-message" id="tableLoadingMessage">
                                    <div class="loading-spinner" style="margin: 0 auto; border-top-color: #7c3aed; border-right-color: transparent;"></div>
                                    <p style="margin-top: 10px;">Loading data...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </main>
    <div class="toast-container" id="toastContainer">
    </div>

    <script src="https://unpkg.com/lucide@0.548.0/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.8/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.8/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.8/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@6.1.8/main.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // --- Sidebar Toggle ---
            const toggleBtn = document.getElementById('toggleBtn');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');

            if (toggleBtn && sidebar && mainContent) {
                toggleBtn.addEventListener('click', () => {
                    sidebar.classList.toggle('collapsed');
                    mainContent.classList.toggle('expanded');
                });
            }
            
            // --- START: FIX FOR SALES DROPDOWN ---
            const salesMenu = document.getElementById('salesMenu');
            if (salesMenu) {
                const navItem = salesMenu.querySelector('.nav-item'); // Find the clickable part
                if (navItem) {
                    navItem.addEventListener('click', (e) => {
                        e.preventDefault(); // Prevent default link behavior if any
                        salesMenu.classList.toggle('open'); // Toggle the 'open' class
                    });
                }
            }
            // --- END: FIX FOR SALES DROPDOWN ---
            
            // --- CRM Menu Toggle ---
            const crmMenu = document.getElementById('crmMenu');
            if (crmMenu) {
                const navItem = crmMenu.querySelector('.nav-item');
                if (navItem) {
                    navItem.addEventListener('click', (e) => {
                        e.preventDefault();
                        crmMenu.classList.toggle('open');
                    });
                }
            }
            
            // --- Profile/Settings ---
            const settingsBtn = document.getElementById('settings-btn');
            if (settingsBtn) {
                settingsBtn.addEventListener('click', () => {
                    window.location.href = '/settings';
                });
            }

            // --- Load Finance Data ---
            loadFinanceData();

            // --- Refresh Button ---
            const refreshBtn = document.getElementById('refreshBtn');
            if(refreshBtn) {
                refreshBtn.addEventListener('click', loadFinanceData);
            }
        });

        /**
         * Main function to load all finance data
         */
        async function loadFinanceData() {
            console.log("Loading finance data...");
            document.getElementById('tableLoadingMessage').style.display = 'table-cell';
            document.getElementById('financeTableBody').innerHTML = `
                <tr>
                    <td colspan="7" class="empty-message" id="tableLoadingMessage">
                        <div class="loading-spinner" style="margin: 0 auto; border-top-color: #7c3aed; border-right-color: transparent;"></div>
                        <p style="margin-top: 10px;">Loading data...</p>
                    </td>
                </tr>`;

            try {
                // Simulating API call delay
                await new Promise(resolve => setTimeout(resolve, 1000)); 
                const data = getMockData(); // Using Mock Data

                populateKpiCards(data.kpiSummary);
                renderRevenueChart(data.charts.revenue);
                renderPipelineChart(data.charts.pipeline);
                populateFinanceTable(data.repSummary);

                document.getElementById('tableLoadingMessage').style.display = 'none';

            } catch (error) {
                console.error('Error loading finance data:', error);
                showToast(`Error: ${error.message}`, 'error');
                document.getElementById('financeTableBody').innerHTML = `
                <tr>
                    <td colspan="7" class="empty-message">
                        <i data-lucide="alert-triangle"></i>
                        <p>Could not load finance data.</p>
                    </td>
                </tr>`;
                lucide.createIcons();
            }
        }
        
        /**
         * Populates the 8 KPI cards
         */
        function populateKpiCards(kpiData) {
            const formatCurrency = (value) => value.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 });
            
            document.getElementById('statTotalPipeline').textContent = formatCurrency(kpiData.totalPipeline);
            document.getElementById('statProjectedRevenue').textContent = formatCurrency(kpiData.projectedRevenue);
            document.getElementById('statWonValue').textContent = formatCurrency(kpiData.wonValue);
            document.getElementById('statConversionRate').textContent = `${kpiData.conversionRate.toFixed(1)}%`;
            document.getElementById('statAvgDealSize').textContent = formatCurrency(kpiData.avgDealSize);
            document.getElementById('statSalesVelocity').textContent = `${formatCurrency(kpiData.salesVelocity)}/day`;
            document.getElementById('statAvgSalesCycle').textContent = `${kpiData.avgSalesCycle.toFixed(0)} days`;
            document.getElementById('statEstClv').textContent = formatCurrency(kpiData.estClv);
        }

        let revenueChartInstance = null;
        let pipelineChartInstance = null;

        /**
         * Renders the Revenue Overview bar chart
         */
        function renderRevenueChart(chartData) {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            if (revenueChartInstance) {
                revenueChartInstance.destroy();
            }

            revenueChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.labels, 
                    datasets: [
                        {
                            label: 'Projected Revenue',
                            data: chartData.projected, 
                            backgroundColor: '#a5b4fc', 
                            borderRadius: 6,
                        },
                        {
                            label: 'Won Value',
                            data: chartData.won, 
                            backgroundColor: '#4f46e5', 
                            borderRadius: 6,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value / 1000 + 'k';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            align: 'end',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.parsed.y !== null) label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0 }).format(context.parsed.y);
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        /**
         * Renders the Pipeline by Stage doughnut chart
         */
        function renderPipelineChart(chartData) {
            const ctx = document.getElementById('pipelineChart').getContext('2d');

            if (pipelineChartInstance) {
                pipelineChartInstance.destroy();
            }

            pipelineChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: chartData.labels, 
                    datasets: [{
                        label: 'Pipeline Value',
                        data: chartData.values, 
                        backgroundColor: ['#4f46e5', '#6366f1', '#a5b4fc', '#c7d2fe'],
                        borderColor: '#ffffff',
                        borderWidth: 2,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    let value = context.parsed;
                                    let sum = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                    let percentage = (value / sum * 100).toFixed(1) + '%';
                                    let currencyValue = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0 }).format(value);
                                    return `${label}: ${currencyValue} (${percentage})`;
                                }
                            }
                        }
                    }
                }
            });
        }

        /**
         * Populates the financial summary table
         */
        function populateFinanceTable(tableData) {
            const tableBody = document.getElementById('financeTableBody');
            if (!tableData || tableData.length === 0) {
                tableBody.innerHTML = `
                <tr>
                    <td colspan="7" class="empty-message">
                        <i data-lucide="inbox"></i>
                        <p>No financial summary data found.</p>
                    </td>
                </tr>`;
                lucide.createIcons();
                return;
            }

            tableBody.innerHTML = ''; 
            const formatCurrency = (value) => value.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 });

            tableData.forEach(rep => {
                tableBody.innerHTML += `
                    <tr>
                        <td>
                            <div class="user-cell">
                                <div class="user-avatar" style="background-color: #eef2ff; color: #4f46e5;">
                                    ${rep.name.charAt(0)}
                                </div>
                                <div class="user-info">
                                    <span class="user-name">${rep.name}</span>
                                    <span class="user-email">${rep.email}</span>
                                </div>
                            </div>
                        </td>
                        <td>${formatCurrency(rep.pipelineValue)}</td>
                        <td>${formatCurrency(rep.wonValue)}</td>
                        <td>${formatCurrency(rep.avgDealSize)}</td>
                        <td>${rep.conversionRate.toFixed(1)}%</td>
                        <td>${rep.avgSalesCycle.toFixed(0)}</td>
                        <td>
                            <span class="status-badge" style="background-color: ${rep.aiWinProb > 70 ? '#dcfce7; color: #166534;' : rep.aiWinProb > 40 ? '#fef9c3; color: #854d0e;' : '#fee2e2; color: #991b1b;'}">
                                ${rep.aiWinProb.toFixed(1)}%
                            </span>
                        </td>
                    </tr>
                `;
            });
        }

        /**
         * Provides mock data for demonstration
         */
        function getMockData() {
            return {
                kpiSummary: {
                    totalPipeline: 1250000, projectedRevenue: 480000, wonValue: 320000,
                    conversionRate: 25.6, avgDealSize: 18823, salesVelocity: 4266,
                    avgSalesCycle: 42, estClv: 56000
                },
                charts: {
                    revenue: {
                        labels: ['May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'],
                        projected: [55000, 60000, 70000, 65000, 80000, 90000],
                        won: [48000, 55000, 62000, 60000, 75000, 82000]
                    },
                    pipeline: {
                        labels: ['Qualification', 'Proposal', 'Negotiation', 'New'],
                        values: [450000, 220000, 130000, 450000]
                    }
                },
                repSummary: [
                    { id: 1, name: 'Alex Johnson', email: 'alex.j@salesos.com', pipelineValue: 450000, wonValue: 120000, avgDealSize: 22000, conversionRate: 26.7, avgSalesCycle: 38, aiWinProb: 65.2 },
                    { id: 2, name: 'Maria Garcia', email: 'maria.g@salesos.com', pipelineValue: 380000, wonValue: 95000, avgDealSize: 17500, conversionRate: 25.0, avgSalesCycle: 45, aiWinProb: 58.0 },
                    { id: 3, name: 'David Kim', email: 'david.k@salesos.com', pipelineValue: 420000, wonValue: 105000, avgDealSize: 19000, conversionRate: 25.0, avgSalesCycle: 41, aiWinProb: 72.5 }
                ]
            };
        }

        /**
         * Simple toast notification function
         */
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            const icon = (type === 'success') ? 'check-circle' : 'alert-circle';
            
            toast.innerHTML = `
                <i data-lucide="${icon}"></i>
                <span>${message}</span>
                <button class="toast-close">&times;</button>
            `;
            
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.classList.add('hide');
                setTimeout(() => toast.remove(), 300);
            });

            container.appendChild(toast);
            lucide.createIcons(); 

            setTimeout(() => {
                toast.classList.add('hide');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

    </script>
    </body>
</html>